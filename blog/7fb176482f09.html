<!DOCTYPE html><html lang="en"><head><meta charSet="UTF-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="og:image" content="images/profile.jpg"/><meta name="author" content="William Surya Jaya"/><meta name="copyright" content="William Surya Jaya"/><meta name="Description" content="William is a highly skilled web developer with several years of expertise. Discover a portfolio of impressive projects and a collection of insightful blogs."/><meta content="William is a highly skilled web developer with several years of expertise. Discover a portfolio of impressive projects and a collection of insightful blogs." property="og:description"/><meta name="keywords" content="web developer, web design, website developer, programmer, coder, wisuja, william surya jaya"/><meta name="google-site-verification" content="1z51jCATexVpodDr7F3kMgAm24F7lhO0wolYM6b2Nb8"/><link rel="icon" href="/favicon.ico"/><title>Streamlining CI/CD process with AWS and Bitbucket Pipelines: A Step-by-Step Guide | William Surya Jaya</title><meta content="Blog | William Surya Jaya" property="og:title"/><meta content="https://wisuja.com/blog" property="og:url"/><meta content="Blog | William Surya Jaya" property="og:site_name"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/e008014af1352176c05b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e008014af1352176c05b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/1307ed9fd803ea15333c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1307ed9fd803ea15333c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6e45eb1a01096bd31273.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e45eb1a01096bd31273.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-4a62052a9e7372c56b6f.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-245f049e565ebf942e09.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2d0daf90a2fa7e03281a.js" as="script"/><link rel="preload" href="/_next/static/chunks/ede286b6.dd32408e2471bd10af40.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.2404f6acca6218beb883.js" as="script"/><link rel="preload" href="/_next/static/chunks/3959927d796506678fc851c04d7ae27fff29a3b4.ae700290d062d3eaf819.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-37fc8646333ab19d5991.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.6a778bb0731dd30dbe5f.js" as="script"/><link rel="preload" href="/_next/static/chunks/a9a7754c.f3ac5a9a4b4ea4cabc57.js" as="script"/><link rel="preload" href="/_next/static/chunks/75fc9c18.c5f381fba2b0f9a9f346.js" as="script"/><link rel="preload" href="/_next/static/chunks/6a460d81fc8dd61038d5640eff0559b3afc3bd7a.f910f1f9daeb461adbb5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bguid%5D-dca374df0f3820da22a8.js" as="script"/></head><body><div id="__next"><div><header class="container mt-3"><div class="row"><div class="col-12"><div class="d-flex justify-content-center align-items-center"><a class="brand_brand__Qjnit" title="William Surya Jaya" href="/"><span class="highlighted">Wi</span>lliam <span class="highlighted">Su</span>rya <span class="highlighted">Ja</span>ya</a></div></div></div><div class="row"><div class="col-12"><div class="line mt-2"> </div><nav class="navigation_navbar__2RuHN navbar"><ul class="navigation_nav__TB-aw nav"><li class="nav-item"><a href="/" title="Home page" class="nav-link">Home</a></li><li class="nav-item"><a href="/projects#projects" title="See William&#x27;s projects" class="nav-link">Projects</a></li><li class="nav-item"><a href="/blog#blog" title="See William&#x27;s blog" class="font-weight-bold nav-link">Blog</a></li></ul></nav><div class="line mb-2"> </div></div></div></header><main class="container"><div class="row"><div class="mt-3 col-6 col-md-4 mx-auto"><img src="/images/profile.jpg" class="img-fluid rounded-circle" alt="Profile Picture"/></div><div class="mt-3 col-sm-12 offset-lg-1 col-lg-7 my-auto"><h1 class="about_hi__2wrx4">Hi there!</h1><p class="text-justify">I&#x27;m William, a full-stack web developer with 3+ years of experience in various industries. I&#x27;m specialized in backend development and have proficiency in Laravel and JavaScript. Highly interested in technological advancements and personal development.</p><p>I also write articles for my blog on<!-- --> <a class="highlighted" target="_blank" href="https://www.medium.com/@wisuja"><u>Medium</u></a>. I usually write about tech, self development, and personal finance. These topics really intrigued me to be better each day.</p><p>I also like to connect with new people, so I’ll be waiting for you to hit me up!</p></div></div><div class="row"><div class="col-12"><div class="my-4 line colored-line"></div><div class="d-flex justify-content-around align-items-center"><a class="social-media_a__23I10" target="_blank" title="William&#x27;s Github" href="https://www.github.com/wisuja"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 mx-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a class="social-media_a__23I10" target="_blank" title="William&#x27;s Instagram" href="https://www.instagram.com/wisuja"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-w-14 mx-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a><a class="social-media_a__23I10" target="_blank" title="William&#x27;s Linkedin" href="https://www.linkedin.com/in/wisuja"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 mx-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="social-media_a__23I10" target="_blank" title="William&#x27;s Medium" href="https://www.medium.com/@wisuja"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="medium" class="svg-inline--fa fa-medium fa-w-14 mx-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg></a></div><div class="my-4 line colored-line"></div></div></div><div class="row"><div class="col-sm-12 mb-3"><button class="btn-dark btn btn-secondary btn-sm"><a href="/blog#blog"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left fa-w-14 mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg>Back to Blog</a></button></div><div class="col-sm-12"><div class="mb-3 card-dark card"><div class="card-body"><h4 class="card-title">Streamlining CI/CD process with AWS and Bitbucket Pipelines: A Step-by-Step Guide</h4><p class="mb-2 card-subtitle">September 19th, 2023</p><div class="mb-3"><span class="mx-1 badge badge-info badge-pill"><span class="font-weight-normal">deployment</span></span><span class="mx-1 badge badge-info badge-pill"><span class="font-weight-normal">cicd</span></span><span class="mx-1 badge badge-info badge-pill"><span class="font-weight-normal">streamlining</span></span><span class="mx-1 badge badge-info badge-pill"><span class="font-weight-normal">bitbucket</span></span><span class="mx-1 badge badge-info badge-pill"><span class="font-weight-normal">aws</span></span></div><div class="article-content">
<figure><img alt="" src="https://cdn-images-1.medium.com/max/852/1*V4wc5I6gTHCccTHPKTixrg.jpeg"><figcaption>CI/CD Integration Flowchart</figcaption></figure><p>TL;DR: This tutorial is also available in video format. Click <a href="https://youtu.be/CU3xm8w5EAA?si=jDdVNADlKj1jZKAY">here</a> to watch it.</p>
<p>In today’s fast-paced software world, automation is your best friend. Our guide is your ticket to automating how you deploy your applications and improving your development process.</p>
<p>By combining the powers of AWS CodeDeploy and Bitbucket Pipelines, we’ll show you how to make continuous integration and deployment a piece of cake.</p>
<p>This guide will be your trusty companion as we walk you through setting up a strong deployment system. We’ll help you blend AWS and Bitbucket seamlessly to make your development process smoother and more efficient than ever before.</p>
<p><em>In this tutorial, I’ll be using ASP.NET Core Project to do CI/CD, please adjust accordingly to your needs. You can get the tutorial repository from </em><a href="https://github.com/wisuja/ASP.NET-CORE-CI-CD-Tutorial-Project"><em>here</em></a><em>.</em></p>
<h3>Part 1: AWS Setup</h3>
<h4>1.1 Create IAM Group</h4>
<ol>
<li>Sign in to the AWS Management Console and open the IAM console at <a href="https://console.aws.amazon.com/iam/">https://console.aws.amazon.com/iam/</a>.</li>
<li>In the navigation pane, click <em>User Groups</em> and then click Create New Group.</li>
<li>In the Group Name box, type the group's name (<em>bit_CodeDeployRole</em>).</li>
<li>In the list of policies, select the check box for Policy:<br><em>* AmazonS3FullAccess<br>* AWSCodeDeployFullAccess</em>
</li>
<li>Click <em>Create Group</em>.</li>
</ol>
<h4>1.2 Create IAM User</h4>
<ol>
<li>Sign in to the AWS Management Console and open the IAM console at <a href="https://console.aws.amazon.com/iam/">https://console.aws.amazon.com/iam/</a>.</li>
<li>In the navigation pane, click <em>Users</em> and then click <em>Add User</em>.</li>
<li>Type the user name (<em>CodeDeployUser</em>) for the new user.</li>
<li><strong>Don’t tick “Provide user access to the AWS Management Console”.</strong></li>
<li>On the Set permissions page, select <em>Add user to group</em> for permission options.</li>
<li>Choose the group that you’ve created in the previous step (<em>bit_CodeDeployRole</em>).</li>
</ol>
<h4>1.2.1 Generate Access Keys</h4>
<ol>
<li>Sign in to the AWS Management Console and open the IAM console at <a href="https://console.aws.amazon.com/iam/">https://console.aws.amazon.com/iam/</a>.</li>
<li>In the navigation pane, click <em>Users</em>.</li>
<li>Click on the username that you want to create access keys for.</li>
<li>Click on the <em>Security Credentials</em> tab.</li>
<li>Under Access Keys, click <em>Create Access keys</em>
</li>
<li>Select the use case, fill in the description, and click <em>Create access key</em>
</li>
<li>Click <em>Download .csv file</em> to save your access key.</li>
</ol>
<blockquote>You cannot view the access keys after you leave this page.</blockquote>
<h4>1.3 Configure IAM Role</h4>
<ol>
<li>Sign in to the AWS Management Console and open the IAM console at <a href="https://console.aws.amazon.com/iam/">https://console.aws.amazon.com/iam/</a>.</li>
<li>In the navigation pane, click <em>Roles</em> and then click <em>Create Role</em>.</li>
<li>Choose <em>AWS service</em> for Trusted entity type.</li>
<li>Choose EC2 for the use case.</li>
<li>Click Next.</li>
<li>In the list of policies, select the check box for Policy:<br>* <em>AmazonS3FullAccess<br>* AWSCodeDeployRole<br>* AmazonEC2FullAccess<br>* AmazonSSMFullAccess</em>
</li>
<li>Enter role name (<em>AWSCodeDeployRole</em>).</li>
<li>Click <em>Create Role</em>.</li>
<li>On the Roles page, click on the role that you just created.</li>
<li>Click the <em>Trust Relationship</em> tab.</li>
<li>Click <em>Edit Trust Policy</em>.</li>
<li>Click <em>Add Principal</em>, choose <em>AWS service</em>, and fill codedeploy.ap-southeast-1.amazonaws.com for ARN (Change region accordingly)</li>
<li>Click Save.</li>
</ol>
<h4>2.1 Create an AWS S3 Bucket</h4>
<ol>
<li>Sign in to the AWS Management Console and open the Amazon S3 console at <a href="https://console.aws.amazon.com/s3/">https://console.aws.amazon.com/s3/</a>.</li>
<li>Click <em>Create Bucket</em>.</li>
<li>Type a unique name for your new bucket in the Bucket name field. Ex: bitbucket-codedeploy-deployment.</li>
<li>For Region, choose <em>Asia Pacific (Singapore) ap-southeast-1</em> as the region where you want the bucket to reside.</li>
<li>Choose <em>ACLs Enabled</em>, and <em>Bucket Owner preferred</em> as the Bucket option.</li>
<li>Click <em>Create Bucket</em>.</li>
</ol>
<h4>3.1 Set Up an AWS EC2 Instance</h4>
<ol>
<li>Sign in to the AWS Management Console and open the Amazon EC2 console at <a href="https://console.aws.amazon.com/s3/ec2">https://console.aws.amazon.com/ec2/</a>.</li>
<li>Click <em>Launch Instance</em>.</li>
<li>Fill in the name for EC2 Instance. Ex: CodeDeployDirect</li>
<li>Choose the required OS Images. I’m using <em>Microsoft Windows Server 2022 Base</em> as I’m trying this.</li>
<li>Click <em>Create a new key pair</em> if you don’t have any key pair. Remember to save the .pem file, you’ll need to access this instance.</li>
<li>Under Network Settings, tick <em>Allow RDP Traffic from Anywhere</em>, <em>Allow HTTP Traffic from Anywhere</em>, <em>Allow HTTPS Traffic from Anywhere</em>.</li>
<li>Under <em>Advanced Options</em>, choose the role that we’ve created for this (AWSCodeDeployRole) for the IAM Instance Profile.</li>
<li>Click <em>Launch Instance</em>.</li>
</ol>
<h4>3.1.1 Connect to Instance</h4>
<ol>
<li>Sign in to the AWS Management Console and open the Amazon EC2 console at <a href="https://console.aws.amazon.com/s3/ec2">https://console.aws.amazon.com/ec2/</a>.</li>
<li>In the navigation pane, choose <em>Instances</em>.</li>
<li>Click on the instance that you just created.</li>
<li>Click <em>Connect</em>.</li>
<li>Click the <em>RDP Client</em> tab. Pick <em>Connect using the RDP client</em>.<br>Download the Remote Desktop Client file.</li>
<li>Click <em>Get Password</em>. You’ll get prompted for the key pair .pem file that we’ve done before.</li>
<li>Connect to the instance using the RDP Client file.</li>
</ol>
<h4>3.1.2 Install IIS</h4>
<ol>
<li>Open up Server Manager.</li>
<li>In the navigation bar, click <em>Add Roles or Features</em>.</li>
<li>Tick <em>Role-based or feature-based installation</em>.</li>
<li>For Server selection, just choose the available server.</li>
<li>In the Server Roles, tick the following features:<br>* Web Server (IIS)<br>* Windows Deployment Services</li>
<li>In the Features, tick <em>.NET 3.5</em> and <em>.NET 4.8</em>.</li>
<li>Then just click <em>Next</em>, and let it install.</li>
<li>If you encounter errors, most probably you’ll need to install <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/hosting-bundle?view=aspnetcore-7.0">NET<br>Core Hosting Bundle</a> first.</li>
</ol>
<h4>3.1.3 Install System Manager Agent</h4>
<ol>
<li>Sign in to the AWS Management Console and open this <a href="https://console.aws.amazon.com/systems-manager/fleet-manager/dhmc">https://console.aws.amazon.com/systems-manager/fleet-manager/dhmc</a>.</li>
<li>
<em>Enable</em> Default Host Management Configuration.</li>
<li>Choose the <em>AWSSystemsManagerDefaultEC2InstanceManagementRole</em> role (<em>create it if you don’t have one</em>).</li>
<li>This will allow our instances to show up in the Fleet Manager as managed nodes. You should be able to see your instance showed up in <a href="https://console.aws.amazon.com/systems-manager/fleet-manager">Fleet Manager</a>.</li>
<li>Connect to the instance.</li>
<li>Install SSM Agent. Follow this <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-install-win.html">instructions</a>.</li>
<li>Run these commands on Powershell.</li>
</ol>
<pre>[System.Net.ServicePointManager]::SecurityProtocol = 'TLS12'<br>$progressPreference = 'silentlyContinue'<br>Invoke-WebRequest `<br>    https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe `<br>    -OutFile $env:USERPROFILE\Desktop\SSMAgent_latest.exe<br><br>Start-Process `<br>    -FilePath $env:USERPROFILE\Desktop\SSMAgent_latest.exe `<br>    -ArgumentList "/S"<br><br>rm -Force $env:USERPROFILE\Desktop\SSMAgent_latest.exe<br><br>Restart-Service AmazonSSMAgent</pre>
<h4>3.1.4 Install CodeDeploy Agent</h4>
<ol>
<li>Sign in to the AWS Management Console and open this <a href="https://console.aws.amazon.com/systems-manager/distributor">https://console.aws.amazon.com/systems-manager/distributor</a>
</li>
<li>Choose <em>AWSCodeDeployAgent</em> and click <em>Install one time</em>.</li>
<li>Use default options, except <em>Target Selection</em>.<br><em>Chooses instances manually</em>, you should be able to choose your instance.</li>
<li>Click <em>Run</em>.</li>
<li>Verify that the service is running on the instance by running this command.</li>
</ol>
<pre>powershell.exe -Command Get-Service -Name codedeployagent</pre>
<h4>4.1 Create an AWS CodeDeploy Application</h4>
<ol>
<li>Sign in to the AWS Management Console and open the CodeDeploy Application console at <a href="https://console.aws.amazon.com/codesuite/codedeploy/applications">https://console.aws.amazon.com/codesuite/codedeploy/applications</a>.</li>
<li>Click <em>Create Application</em>.</li>
<li>Fill in the Application Name (e.g.: <em>directcodedeploy</em>) and choose <em>EC2/On-premises</em> as the Compute Platform.</li>
<li>Under <em>Deployment Groups</em>, click <em>Create Deployment Group</em>.</li>
<li>Fill necessary fields:<br>* Deployment Group: DG1 (<em>Anything</em>)<br>* Service Role: AWSCodeDeployRole<br>* Deployment Type: In-place<br>* Environment Configuration:<br>- Tick <em>Amazon EC2 instances<br>- </em>Fill in the <em>Name</em> for Key<br>- Choose the instance name in the Value field. Ex: CodeDeployDirect<br>- Should show 1 matching instance.<br>* Deployment Settings: <em>CodeDeployDefault.OneAtATime<br></em>* Load Balancer: <em>Disabled</em>
</li>
<li>Click <em>Create Deployment Group</em>.</li>
</ol>
<h3>Part 2: Bitbucket Configuration</h3>
<h4>1. Enable Pipelines</h4>
<ol>
<li>Sign in to the Bitbucket and navigate to your repository.</li>
<li>On the sidebar, navigate to <em>Repository Settings</em>.</li>
<li>Under the Pipelines section, click <em>Settings</em>.</li>
<li>Enable Pipelines.</li>
</ol>
<h4>2. Create bitbucket-pipelines.yml in the root folder of the project</h4>
<p>The example below is for the <strong>ASP NET Core 6 Web Application</strong>.<br>Please update accordingly.</p>
<pre>image: mcr.microsoft.com/dotnet/sdk:6.0<br>pipelines:<br> default:<br>  - step:<br>    name: Build and Test<br>    caches:<br>     - dotnetcore<br>    script:<br>     - dotnet restore<br>     - dotnet build<br>     - dotnet test<br>  - step:<br>    name: Publish and Deploy<br>    deployment: staging<br>    script:<br>     - apt-get update &amp;&amp; apt-get install zip -y<br>     - dotnet publish -c Release -o ./publish<br>     - cp appspec.yml ./publish/appspec.yml<br>     - cp before-iis-install-stop.bat ./publish/before-iis-install-stop.bat<br>     - cp after-iis-install-start.bat ./publish/after-iis-install-start.bat<br>     - cd ./publish<br>     - zip -r WebApp.zip .<br>     - pipe: atlassian/aws-code-deploy:0.2.5<br>      variables:<br>       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION<br>       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID<br>       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY<br>       APPLICATION_NAME: $APPLICATION_NAME<br>       S3_BUCKET: $S3_BUCKET<br>       COMMAND: "upload"<br>       ZIP_FILE: "WebApp.zip"<br>       VERSION_LABEL: "web-app-1.0.0"<br>     - pipe: atlassian/aws-code-deploy:0.2.5<br>      variables:<br>       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION<br>       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID<br>       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY<br>       APPLICATION_NAME: $APPLICATION_NAME<br>       DEPLOYMENT_GROUP: $DEPLOYMENT_GROUP<br>       S3_BUCKET: $S3_BUCKET<br>       COMMAND: "deploy"<br>       WAIT: "true"<br>       VERSION_LABEL: "web-app-1.0.0"<br>       IGNORE_APPLICATION_STOP_FAILURES: "true"<br>       FILE_EXISTS_BEHAVIOR: "OVERWRITE"<br>       DEBUG: "true"<br>    artifacts:<br>     - dist/**</pre>
<h4>3. Create appspec.yml, before-iis-install-stop.bat, and after-iis-install-start.bat in the root folder of the project</h4>
<p>appspec.yml is to tell AWS CodeDeploy what to do in the deployment process.<br>before-iis-install-stop.bat will stop IIS before overwriting the files to prevent IIS from still accessing the web files.<br>after-iis-install-start.bat will start IIS after copying the web files.</p>
<h4>4. Add Repository Variables</h4>
<ol>
<li>Sign in to the Bitbucket and navigate to your repository.</li>
<li>On the sidebar, navigate to <em>Repository Settings</em>.</li>
<li>Under the Pipelines section, click <em>Repository Variables</em>.</li>
<li>These are required variables in the bitbucket-pipelines.yml:<br>* AWS_ACCESS_KEY_ID<br>* AWS_SECRET_ACCESS_KEY<br>* AWS_DEFAULT_REGION<br>* S3_BUCKET<br>* APPLICATION_NAME<br>* DEPLOYMENT_GROUP</li>
</ol>
<p>By following these detailed steps, you can establish a powerful and automated deployment pipeline, ensuring the smooth delivery of your applications from Bitbucket to AWS services. Say goodbye to manual deployment headaches and embrace the future of streamlined development workflows.</p>
<p>Happy coding and deploying!</p>
<img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=7fb176482f09" width="1" height="1" alt="">
</div><button class="btn-dark btn btn-secondary btn-sm"><a target="_blank" href="https://medium.com/p/7fb176482f09">Read on Medium</a></button></div></div></div><div class="col-sm-12 mb-3"><button class="btn-dark btn btn-secondary btn-sm"><a href="/blog#blog"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left fa-w-14 mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg>Back to Blog</a></button></div></div></main><footer class="container mt-3"><div class="line"> </div><p class="text-center mt-3"><span style="font-size:0.8rem"> <!-- -->Copyright © 2021 William Surya Jaya. All rights reserved.</span></p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"isError":false,"article":{"title":"Streamlining CI/CD process with AWS and Bitbucket Pipelines: A Step-by-Step Guide","pubDate":"2023-09-19 03:57:45","link":"https://wisuja.medium.com/streamlining-ci-cd-process-with-aws-and-bitbucket-pipelines-a-step-by-step-guide-7fb176482f09?source=rss-3e448fdc1a01------2","guid":"https://medium.com/p/7fb176482f09","author":"William SJ","thumbnail":"https://cdn-images-1.medium.com/max/852/1*V4wc5I6gTHCccTHPKTixrg.jpeg","description":"\n\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://cdn-images-1.medium.com/max/852/1*V4wc5I6gTHCccTHPKTixrg.jpeg\"\u003e\u003cfigcaption\u003eCI/CD Integration Flowchart\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003eTL;DR: This tutorial is also available in video format. Click \u003ca href=\"https://youtu.be/CU3xm8w5EAA?si=jDdVNADlKj1jZKAY\"\u003ehere\u003c/a\u003e to watch it.\u003c/p\u003e\n\u003cp\u003eIn today’s fast-paced software world, automation is your best friend. Our guide is your ticket to automating how you deploy your applications and improving your development process.\u003c/p\u003e\n\u003cp\u003eBy combining the powers of AWS CodeDeploy and Bitbucket Pipelines, we’ll show you how to make continuous integration and deployment a piece of cake.\u003c/p\u003e\n\u003cp\u003eThis guide will be your trusty companion as we walk you through setting up a strong deployment system. We’ll help you blend AWS and Bitbucket seamlessly to make your development process smoother and more efficient than ever before.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eIn this tutorial, I’ll be using ASP.NET Core Project to do CI/CD, please adjust accordingly to your needs. You can get the tutorial repository from \u003c/em\u003e\u003ca href=\"https://github.com/wisuja/ASP.NET-CORE-CI-CD-Tutorial-Project\"\u003e\u003cem\u003ehere\u003c/em\u003e\u003c/a\u003e\u003cem\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch3\u003ePart 1: AWS Setup\u003c/h3\u003e\n\u003ch4\u003e1.1 Create IAM Group\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUser Groups\u003c/em\u003e and then click Create New Group.\u003c/li\u003e\n\u003cli\u003eIn the Group Name box, type the group's name (\u003cem\u003ebit_CodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eIn the list of policies, select the check box for Policy:\u003cbr\u003e\u003cem\u003e* AmazonS3FullAccess\u003cbr\u003e* AWSCodeDeployFullAccess\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Group\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e1.2 Create IAM User\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUsers\u003c/em\u003e and then click \u003cem\u003eAdd User\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eType the user name (\u003cem\u003eCodeDeployUser\u003c/em\u003e) for the new user.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDon’t tick “Provide user access to the AWS Management Console”.\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eOn the Set permissions page, select \u003cem\u003eAdd user to group\u003c/em\u003e for permission options.\u003c/li\u003e\n\u003cli\u003eChoose the group that you’ve created in the previous step (\u003cem\u003ebit_CodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e1.2.1 Generate Access Keys\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUsers\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick on the username that you want to create access keys for.\u003c/li\u003e\n\u003cli\u003eClick on the \u003cem\u003eSecurity Credentials\u003c/em\u003e tab.\u003c/li\u003e\n\u003cli\u003eUnder Access Keys, click \u003cem\u003eCreate Access keys\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eSelect the use case, fill in the description, and click \u003cem\u003eCreate access key\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eDownload .csv file\u003c/em\u003e to save your access key.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003eYou cannot view the access keys after you leave this page.\u003c/blockquote\u003e\n\u003ch4\u003e1.3 Configure IAM Role\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eRoles\u003c/em\u003e and then click \u003cem\u003eCreate Role\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eAWS service\u003c/em\u003e for Trusted entity type.\u003c/li\u003e\n\u003cli\u003eChoose EC2 for the use case.\u003c/li\u003e\n\u003cli\u003eClick Next.\u003c/li\u003e\n\u003cli\u003eIn the list of policies, select the check box for Policy:\u003cbr\u003e* \u003cem\u003eAmazonS3FullAccess\u003cbr\u003e* AWSCodeDeployRole\u003cbr\u003e* AmazonEC2FullAccess\u003cbr\u003e* AmazonSSMFullAccess\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eEnter role name (\u003cem\u003eAWSCodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Role\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eOn the Roles page, click on the role that you just created.\u003c/li\u003e\n\u003cli\u003eClick the \u003cem\u003eTrust Relationship\u003c/em\u003e tab.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eEdit Trust Policy\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eAdd Principal\u003c/em\u003e, choose \u003cem\u003eAWS service\u003c/em\u003e, and fill codedeploy.ap-southeast-1.amazonaws.com for ARN (Change region accordingly)\u003c/li\u003e\n\u003cli\u003eClick Save.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e2.1 Create an AWS S3 Bucket\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon S3 console at \u003ca href=\"https://console.aws.amazon.com/s3/\"\u003ehttps://console.aws.amazon.com/s3/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Bucket\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eType a unique name for your new bucket in the Bucket name field. Ex: bitbucket-codedeploy-deployment.\u003c/li\u003e\n\u003cli\u003eFor Region, choose \u003cem\u003eAsia Pacific (Singapore) ap-southeast-1\u003c/em\u003e as the region where you want the bucket to reside.\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eACLs Enabled\u003c/em\u003e, and \u003cem\u003eBucket Owner preferred\u003c/em\u003e as the Bucket option.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Bucket\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1 Set Up an AWS EC2 Instance\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon EC2 console at \u003ca href=\"https://console.aws.amazon.com/s3/ec2\"\u003ehttps://console.aws.amazon.com/ec2/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eLaunch Instance\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill in the name for EC2 Instance. Ex: CodeDeployDirect\u003c/li\u003e\n\u003cli\u003eChoose the required OS Images. I’m using \u003cem\u003eMicrosoft Windows Server 2022 Base\u003c/em\u003e as I’m trying this.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate a new key pair\u003c/em\u003e if you don’t have any key pair. Remember to save the .pem file, you’ll need to access this instance.\u003c/li\u003e\n\u003cli\u003eUnder Network Settings, tick \u003cem\u003eAllow RDP Traffic from Anywhere\u003c/em\u003e, \u003cem\u003eAllow HTTP Traffic from Anywhere\u003c/em\u003e, \u003cem\u003eAllow HTTPS Traffic from Anywhere\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder \u003cem\u003eAdvanced Options\u003c/em\u003e, choose the role that we’ve created for this (AWSCodeDeployRole) for the IAM Instance Profile.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eLaunch Instance\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.1 Connect to Instance\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon EC2 console at \u003ca href=\"https://console.aws.amazon.com/s3/ec2\"\u003ehttps://console.aws.amazon.com/ec2/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, choose \u003cem\u003eInstances\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick on the instance that you just created.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eConnect\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick the \u003cem\u003eRDP Client\u003c/em\u003e tab. Pick \u003cem\u003eConnect using the RDP client\u003c/em\u003e.\u003cbr\u003eDownload the Remote Desktop Client file.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eGet Password\u003c/em\u003e. You’ll get prompted for the key pair .pem file that we’ve done before.\u003c/li\u003e\n\u003cli\u003eConnect to the instance using the RDP Client file.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.2 Install IIS\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eOpen up Server Manager.\u003c/li\u003e\n\u003cli\u003eIn the navigation bar, click \u003cem\u003eAdd Roles or Features\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eTick \u003cem\u003eRole-based or feature-based installation\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFor Server selection, just choose the available server.\u003c/li\u003e\n\u003cli\u003eIn the Server Roles, tick the following features:\u003cbr\u003e* Web Server (IIS)\u003cbr\u003e* Windows Deployment Services\u003c/li\u003e\n\u003cli\u003eIn the Features, tick \u003cem\u003e.NET 3.5\u003c/em\u003e and \u003cem\u003e.NET 4.8\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eThen just click \u003cem\u003eNext\u003c/em\u003e, and let it install.\u003c/li\u003e\n\u003cli\u003eIf you encounter errors, most probably you’ll need to install \u003ca href=\"https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/hosting-bundle?view=aspnetcore-7.0\"\u003eNET\u003cbr\u003eCore Hosting Bundle\u003c/a\u003e first.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.3 Install System Manager Agent\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open this \u003ca href=\"https://console.aws.amazon.com/systems-manager/fleet-manager/dhmc\"\u003ehttps://console.aws.amazon.com/systems-manager/fleet-manager/dhmc\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eEnable\u003c/em\u003e Default Host Management Configuration.\u003c/li\u003e\n\u003cli\u003eChoose the \u003cem\u003eAWSSystemsManagerDefaultEC2InstanceManagementRole\u003c/em\u003e role (\u003cem\u003ecreate it if you don’t have one\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eThis will allow our instances to show up in the Fleet Manager as managed nodes. You should be able to see your instance showed up in \u003ca href=\"https://console.aws.amazon.com/systems-manager/fleet-manager\"\u003eFleet Manager\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eConnect to the instance.\u003c/li\u003e\n\u003cli\u003eInstall SSM Agent. Follow this \u003ca href=\"https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-install-win.html\"\u003einstructions\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eRun these commands on Powershell.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e[System.Net.ServicePointManager]::SecurityProtocol = 'TLS12'\u003cbr\u003e$progressPreference = 'silentlyContinue'\u003cbr\u003eInvoke-WebRequest `\u003cbr\u003e    https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe `\u003cbr\u003e    -OutFile $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe\u003cbr\u003e\u003cbr\u003eStart-Process `\u003cbr\u003e    -FilePath $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe `\u003cbr\u003e    -ArgumentList \"/S\"\u003cbr\u003e\u003cbr\u003erm -Force $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe\u003cbr\u003e\u003cbr\u003eRestart-Service AmazonSSMAgent\u003c/pre\u003e\n\u003ch4\u003e3.1.4 Install CodeDeploy Agent\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open this \u003ca href=\"https://console.aws.amazon.com/systems-manager/distributor\"\u003ehttps://console.aws.amazon.com/systems-manager/distributor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eAWSCodeDeployAgent\u003c/em\u003e and click \u003cem\u003eInstall one time\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUse default options, except \u003cem\u003eTarget Selection\u003c/em\u003e.\u003cbr\u003e\u003cem\u003eChooses instances manually\u003c/em\u003e, you should be able to choose your instance.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eRun\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eVerify that the service is running on the instance by running this command.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003epowershell.exe -Command Get-Service -Name codedeployagent\u003c/pre\u003e\n\u003ch4\u003e4.1 Create an AWS CodeDeploy Application\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the CodeDeploy Application console at \u003ca href=\"https://console.aws.amazon.com/codesuite/codedeploy/applications\"\u003ehttps://console.aws.amazon.com/codesuite/codedeploy/applications\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Application\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill in the Application Name (e.g.: \u003cem\u003edirectcodedeploy\u003c/em\u003e) and choose \u003cem\u003eEC2/On-premises\u003c/em\u003e as the Compute Platform.\u003c/li\u003e\n\u003cli\u003eUnder \u003cem\u003eDeployment Groups\u003c/em\u003e, click \u003cem\u003eCreate Deployment Group\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill necessary fields:\u003cbr\u003e* Deployment Group: DG1 (\u003cem\u003eAnything\u003c/em\u003e)\u003cbr\u003e* Service Role: AWSCodeDeployRole\u003cbr\u003e* Deployment Type: In-place\u003cbr\u003e* Environment Configuration:\u003cbr\u003e- Tick \u003cem\u003eAmazon EC2 instances\u003cbr\u003e- \u003c/em\u003eFill in the \u003cem\u003eName\u003c/em\u003e for Key\u003cbr\u003e- Choose the instance name in the Value field. Ex: CodeDeployDirect\u003cbr\u003e- Should show 1 matching instance.\u003cbr\u003e* Deployment Settings: \u003cem\u003eCodeDeployDefault.OneAtATime\u003cbr\u003e\u003c/em\u003e* Load Balancer: \u003cem\u003eDisabled\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Deployment Group\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003ePart 2: Bitbucket Configuration\u003c/h3\u003e\n\u003ch4\u003e1. Enable Pipelines\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the Bitbucket and navigate to your repository.\u003c/li\u003e\n\u003cli\u003eOn the sidebar, navigate to \u003cem\u003eRepository Settings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder the Pipelines section, click \u003cem\u003eSettings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eEnable Pipelines.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e2. Create bitbucket-pipelines.yml in the root folder of the project\u003c/h4\u003e\n\u003cp\u003eThe example below is for the \u003cstrong\u003eASP NET Core 6 Web Application\u003c/strong\u003e.\u003cbr\u003ePlease update accordingly.\u003c/p\u003e\n\u003cpre\u003eimage: mcr.microsoft.com/dotnet/sdk:6.0\u003cbr\u003epipelines:\u003cbr\u003e default:\u003cbr\u003e  - step:\u003cbr\u003e    name: Build and Test\u003cbr\u003e    caches:\u003cbr\u003e     - dotnetcore\u003cbr\u003e    script:\u003cbr\u003e     - dotnet restore\u003cbr\u003e     - dotnet build\u003cbr\u003e     - dotnet test\u003cbr\u003e  - step:\u003cbr\u003e    name: Publish and Deploy\u003cbr\u003e    deployment: staging\u003cbr\u003e    script:\u003cbr\u003e     - apt-get update \u0026amp;\u0026amp; apt-get install zip -y\u003cbr\u003e     - dotnet publish -c Release -o ./publish\u003cbr\u003e     - cp appspec.yml ./publish/appspec.yml\u003cbr\u003e     - cp before-iis-install-stop.bat ./publish/before-iis-install-stop.bat\u003cbr\u003e     - cp after-iis-install-start.bat ./publish/after-iis-install-start.bat\u003cbr\u003e     - cd ./publish\u003cbr\u003e     - zip -r WebApp.zip .\u003cbr\u003e     - pipe: atlassian/aws-code-deploy:0.2.5\u003cbr\u003e      variables:\u003cbr\u003e       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION\u003cbr\u003e       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID\u003cbr\u003e       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY\u003cbr\u003e       APPLICATION_NAME: $APPLICATION_NAME\u003cbr\u003e       S3_BUCKET: $S3_BUCKET\u003cbr\u003e       COMMAND: \"upload\"\u003cbr\u003e       ZIP_FILE: \"WebApp.zip\"\u003cbr\u003e       VERSION_LABEL: \"web-app-1.0.0\"\u003cbr\u003e     - pipe: atlassian/aws-code-deploy:0.2.5\u003cbr\u003e      variables:\u003cbr\u003e       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION\u003cbr\u003e       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID\u003cbr\u003e       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY\u003cbr\u003e       APPLICATION_NAME: $APPLICATION_NAME\u003cbr\u003e       DEPLOYMENT_GROUP: $DEPLOYMENT_GROUP\u003cbr\u003e       S3_BUCKET: $S3_BUCKET\u003cbr\u003e       COMMAND: \"deploy\"\u003cbr\u003e       WAIT: \"true\"\u003cbr\u003e       VERSION_LABEL: \"web-app-1.0.0\"\u003cbr\u003e       IGNORE_APPLICATION_STOP_FAILURES: \"true\"\u003cbr\u003e       FILE_EXISTS_BEHAVIOR: \"OVERWRITE\"\u003cbr\u003e       DEBUG: \"true\"\u003cbr\u003e    artifacts:\u003cbr\u003e     - dist/**\u003c/pre\u003e\n\u003ch4\u003e3. Create appspec.yml, before-iis-install-stop.bat, and after-iis-install-start.bat in the root folder of the project\u003c/h4\u003e\n\u003cp\u003eappspec.yml is to tell AWS CodeDeploy what to do in the deployment process.\u003cbr\u003ebefore-iis-install-stop.bat will stop IIS before overwriting the files to prevent IIS from still accessing the web files.\u003cbr\u003eafter-iis-install-start.bat will start IIS after copying the web files.\u003c/p\u003e\n\u003ch4\u003e4. Add Repository Variables\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the Bitbucket and navigate to your repository.\u003c/li\u003e\n\u003cli\u003eOn the sidebar, navigate to \u003cem\u003eRepository Settings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder the Pipelines section, click \u003cem\u003eRepository Variables\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eThese are required variables in the bitbucket-pipelines.yml:\u003cbr\u003e* AWS_ACCESS_KEY_ID\u003cbr\u003e* AWS_SECRET_ACCESS_KEY\u003cbr\u003e* AWS_DEFAULT_REGION\u003cbr\u003e* S3_BUCKET\u003cbr\u003e* APPLICATION_NAME\u003cbr\u003e* DEPLOYMENT_GROUP\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eBy following these detailed steps, you can establish a powerful and automated deployment pipeline, ensuring the smooth delivery of your applications from Bitbucket to AWS services. Say goodbye to manual deployment headaches and embrace the future of streamlined development workflows.\u003c/p\u003e\n\u003cp\u003eHappy coding and deploying!\u003c/p\u003e\n\u003cimg src=\"https://medium.com/_/stat?event=post.clientViewed\u0026amp;referrerSource=full_rss\u0026amp;postId=7fb176482f09\" width=\"1\" height=\"1\" alt=\"\"\u003e\n","content":"\n\u003cfigure\u003e\u003cimg alt=\"\" src=\"https://cdn-images-1.medium.com/max/852/1*V4wc5I6gTHCccTHPKTixrg.jpeg\"\u003e\u003cfigcaption\u003eCI/CD Integration Flowchart\u003c/figcaption\u003e\u003c/figure\u003e\u003cp\u003eTL;DR: This tutorial is also available in video format. Click \u003ca href=\"https://youtu.be/CU3xm8w5EAA?si=jDdVNADlKj1jZKAY\"\u003ehere\u003c/a\u003e to watch it.\u003c/p\u003e\n\u003cp\u003eIn today’s fast-paced software world, automation is your best friend. Our guide is your ticket to automating how you deploy your applications and improving your development process.\u003c/p\u003e\n\u003cp\u003eBy combining the powers of AWS CodeDeploy and Bitbucket Pipelines, we’ll show you how to make continuous integration and deployment a piece of cake.\u003c/p\u003e\n\u003cp\u003eThis guide will be your trusty companion as we walk you through setting up a strong deployment system. We’ll help you blend AWS and Bitbucket seamlessly to make your development process smoother and more efficient than ever before.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eIn this tutorial, I’ll be using ASP.NET Core Project to do CI/CD, please adjust accordingly to your needs. You can get the tutorial repository from \u003c/em\u003e\u003ca href=\"https://github.com/wisuja/ASP.NET-CORE-CI-CD-Tutorial-Project\"\u003e\u003cem\u003ehere\u003c/em\u003e\u003c/a\u003e\u003cem\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch3\u003ePart 1: AWS Setup\u003c/h3\u003e\n\u003ch4\u003e1.1 Create IAM Group\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUser Groups\u003c/em\u003e and then click Create New Group.\u003c/li\u003e\n\u003cli\u003eIn the Group Name box, type the group's name (\u003cem\u003ebit_CodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eIn the list of policies, select the check box for Policy:\u003cbr\u003e\u003cem\u003e* AmazonS3FullAccess\u003cbr\u003e* AWSCodeDeployFullAccess\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Group\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e1.2 Create IAM User\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUsers\u003c/em\u003e and then click \u003cem\u003eAdd User\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eType the user name (\u003cem\u003eCodeDeployUser\u003c/em\u003e) for the new user.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDon’t tick “Provide user access to the AWS Management Console”.\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eOn the Set permissions page, select \u003cem\u003eAdd user to group\u003c/em\u003e for permission options.\u003c/li\u003e\n\u003cli\u003eChoose the group that you’ve created in the previous step (\u003cem\u003ebit_CodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e1.2.1 Generate Access Keys\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eUsers\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick on the username that you want to create access keys for.\u003c/li\u003e\n\u003cli\u003eClick on the \u003cem\u003eSecurity Credentials\u003c/em\u003e tab.\u003c/li\u003e\n\u003cli\u003eUnder Access Keys, click \u003cem\u003eCreate Access keys\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eSelect the use case, fill in the description, and click \u003cem\u003eCreate access key\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eDownload .csv file\u003c/em\u003e to save your access key.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003eYou cannot view the access keys after you leave this page.\u003c/blockquote\u003e\n\u003ch4\u003e1.3 Configure IAM Role\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the IAM console at \u003ca href=\"https://console.aws.amazon.com/iam/\"\u003ehttps://console.aws.amazon.com/iam/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, click \u003cem\u003eRoles\u003c/em\u003e and then click \u003cem\u003eCreate Role\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eAWS service\u003c/em\u003e for Trusted entity type.\u003c/li\u003e\n\u003cli\u003eChoose EC2 for the use case.\u003c/li\u003e\n\u003cli\u003eClick Next.\u003c/li\u003e\n\u003cli\u003eIn the list of policies, select the check box for Policy:\u003cbr\u003e* \u003cem\u003eAmazonS3FullAccess\u003cbr\u003e* AWSCodeDeployRole\u003cbr\u003e* AmazonEC2FullAccess\u003cbr\u003e* AmazonSSMFullAccess\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eEnter role name (\u003cem\u003eAWSCodeDeployRole\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Role\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eOn the Roles page, click on the role that you just created.\u003c/li\u003e\n\u003cli\u003eClick the \u003cem\u003eTrust Relationship\u003c/em\u003e tab.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eEdit Trust Policy\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eAdd Principal\u003c/em\u003e, choose \u003cem\u003eAWS service\u003c/em\u003e, and fill codedeploy.ap-southeast-1.amazonaws.com for ARN (Change region accordingly)\u003c/li\u003e\n\u003cli\u003eClick Save.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e2.1 Create an AWS S3 Bucket\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon S3 console at \u003ca href=\"https://console.aws.amazon.com/s3/\"\u003ehttps://console.aws.amazon.com/s3/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Bucket\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eType a unique name for your new bucket in the Bucket name field. Ex: bitbucket-codedeploy-deployment.\u003c/li\u003e\n\u003cli\u003eFor Region, choose \u003cem\u003eAsia Pacific (Singapore) ap-southeast-1\u003c/em\u003e as the region where you want the bucket to reside.\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eACLs Enabled\u003c/em\u003e, and \u003cem\u003eBucket Owner preferred\u003c/em\u003e as the Bucket option.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Bucket\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1 Set Up an AWS EC2 Instance\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon EC2 console at \u003ca href=\"https://console.aws.amazon.com/s3/ec2\"\u003ehttps://console.aws.amazon.com/ec2/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eLaunch Instance\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill in the name for EC2 Instance. Ex: CodeDeployDirect\u003c/li\u003e\n\u003cli\u003eChoose the required OS Images. I’m using \u003cem\u003eMicrosoft Windows Server 2022 Base\u003c/em\u003e as I’m trying this.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate a new key pair\u003c/em\u003e if you don’t have any key pair. Remember to save the .pem file, you’ll need to access this instance.\u003c/li\u003e\n\u003cli\u003eUnder Network Settings, tick \u003cem\u003eAllow RDP Traffic from Anywhere\u003c/em\u003e, \u003cem\u003eAllow HTTP Traffic from Anywhere\u003c/em\u003e, \u003cem\u003eAllow HTTPS Traffic from Anywhere\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder \u003cem\u003eAdvanced Options\u003c/em\u003e, choose the role that we’ve created for this (AWSCodeDeployRole) for the IAM Instance Profile.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eLaunch Instance\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.1 Connect to Instance\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the Amazon EC2 console at \u003ca href=\"https://console.aws.amazon.com/s3/ec2\"\u003ehttps://console.aws.amazon.com/ec2/\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eIn the navigation pane, choose \u003cem\u003eInstances\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick on the instance that you just created.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eConnect\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eClick the \u003cem\u003eRDP Client\u003c/em\u003e tab. Pick \u003cem\u003eConnect using the RDP client\u003c/em\u003e.\u003cbr\u003eDownload the Remote Desktop Client file.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eGet Password\u003c/em\u003e. You’ll get prompted for the key pair .pem file that we’ve done before.\u003c/li\u003e\n\u003cli\u003eConnect to the instance using the RDP Client file.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.2 Install IIS\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eOpen up Server Manager.\u003c/li\u003e\n\u003cli\u003eIn the navigation bar, click \u003cem\u003eAdd Roles or Features\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eTick \u003cem\u003eRole-based or feature-based installation\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFor Server selection, just choose the available server.\u003c/li\u003e\n\u003cli\u003eIn the Server Roles, tick the following features:\u003cbr\u003e* Web Server (IIS)\u003cbr\u003e* Windows Deployment Services\u003c/li\u003e\n\u003cli\u003eIn the Features, tick \u003cem\u003e.NET 3.5\u003c/em\u003e and \u003cem\u003e.NET 4.8\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eThen just click \u003cem\u003eNext\u003c/em\u003e, and let it install.\u003c/li\u003e\n\u003cli\u003eIf you encounter errors, most probably you’ll need to install \u003ca href=\"https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/hosting-bundle?view=aspnetcore-7.0\"\u003eNET\u003cbr\u003eCore Hosting Bundle\u003c/a\u003e first.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e3.1.3 Install System Manager Agent\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open this \u003ca href=\"https://console.aws.amazon.com/systems-manager/fleet-manager/dhmc\"\u003ehttps://console.aws.amazon.com/systems-manager/fleet-manager/dhmc\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eEnable\u003c/em\u003e Default Host Management Configuration.\u003c/li\u003e\n\u003cli\u003eChoose the \u003cem\u003eAWSSystemsManagerDefaultEC2InstanceManagementRole\u003c/em\u003e role (\u003cem\u003ecreate it if you don’t have one\u003c/em\u003e).\u003c/li\u003e\n\u003cli\u003eThis will allow our instances to show up in the Fleet Manager as managed nodes. You should be able to see your instance showed up in \u003ca href=\"https://console.aws.amazon.com/systems-manager/fleet-manager\"\u003eFleet Manager\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eConnect to the instance.\u003c/li\u003e\n\u003cli\u003eInstall SSM Agent. Follow this \u003ca href=\"https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-install-win.html\"\u003einstructions\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eRun these commands on Powershell.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e[System.Net.ServicePointManager]::SecurityProtocol = 'TLS12'\u003cbr\u003e$progressPreference = 'silentlyContinue'\u003cbr\u003eInvoke-WebRequest `\u003cbr\u003e    https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe `\u003cbr\u003e    -OutFile $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe\u003cbr\u003e\u003cbr\u003eStart-Process `\u003cbr\u003e    -FilePath $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe `\u003cbr\u003e    -ArgumentList \"/S\"\u003cbr\u003e\u003cbr\u003erm -Force $env:USERPROFILE\\Desktop\\SSMAgent_latest.exe\u003cbr\u003e\u003cbr\u003eRestart-Service AmazonSSMAgent\u003c/pre\u003e\n\u003ch4\u003e3.1.4 Install CodeDeploy Agent\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open this \u003ca href=\"https://console.aws.amazon.com/systems-manager/distributor\"\u003ehttps://console.aws.amazon.com/systems-manager/distributor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eChoose \u003cem\u003eAWSCodeDeployAgent\u003c/em\u003e and click \u003cem\u003eInstall one time\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUse default options, except \u003cem\u003eTarget Selection\u003c/em\u003e.\u003cbr\u003e\u003cem\u003eChooses instances manually\u003c/em\u003e, you should be able to choose your instance.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eRun\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eVerify that the service is running on the instance by running this command.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003epowershell.exe -Command Get-Service -Name codedeployagent\u003c/pre\u003e\n\u003ch4\u003e4.1 Create an AWS CodeDeploy Application\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the AWS Management Console and open the CodeDeploy Application console at \u003ca href=\"https://console.aws.amazon.com/codesuite/codedeploy/applications\"\u003ehttps://console.aws.amazon.com/codesuite/codedeploy/applications\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Application\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill in the Application Name (e.g.: \u003cem\u003edirectcodedeploy\u003c/em\u003e) and choose \u003cem\u003eEC2/On-premises\u003c/em\u003e as the Compute Platform.\u003c/li\u003e\n\u003cli\u003eUnder \u003cem\u003eDeployment Groups\u003c/em\u003e, click \u003cem\u003eCreate Deployment Group\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eFill necessary fields:\u003cbr\u003e* Deployment Group: DG1 (\u003cem\u003eAnything\u003c/em\u003e)\u003cbr\u003e* Service Role: AWSCodeDeployRole\u003cbr\u003e* Deployment Type: In-place\u003cbr\u003e* Environment Configuration:\u003cbr\u003e- Tick \u003cem\u003eAmazon EC2 instances\u003cbr\u003e- \u003c/em\u003eFill in the \u003cem\u003eName\u003c/em\u003e for Key\u003cbr\u003e- Choose the instance name in the Value field. Ex: CodeDeployDirect\u003cbr\u003e- Should show 1 matching instance.\u003cbr\u003e* Deployment Settings: \u003cem\u003eCodeDeployDefault.OneAtATime\u003cbr\u003e\u003c/em\u003e* Load Balancer: \u003cem\u003eDisabled\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003cem\u003eCreate Deployment Group\u003c/em\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003ePart 2: Bitbucket Configuration\u003c/h3\u003e\n\u003ch4\u003e1. Enable Pipelines\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the Bitbucket and navigate to your repository.\u003c/li\u003e\n\u003cli\u003eOn the sidebar, navigate to \u003cem\u003eRepository Settings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder the Pipelines section, click \u003cem\u003eSettings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eEnable Pipelines.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e2. Create bitbucket-pipelines.yml in the root folder of the project\u003c/h4\u003e\n\u003cp\u003eThe example below is for the \u003cstrong\u003eASP NET Core 6 Web Application\u003c/strong\u003e.\u003cbr\u003ePlease update accordingly.\u003c/p\u003e\n\u003cpre\u003eimage: mcr.microsoft.com/dotnet/sdk:6.0\u003cbr\u003epipelines:\u003cbr\u003e default:\u003cbr\u003e  - step:\u003cbr\u003e    name: Build and Test\u003cbr\u003e    caches:\u003cbr\u003e     - dotnetcore\u003cbr\u003e    script:\u003cbr\u003e     - dotnet restore\u003cbr\u003e     - dotnet build\u003cbr\u003e     - dotnet test\u003cbr\u003e  - step:\u003cbr\u003e    name: Publish and Deploy\u003cbr\u003e    deployment: staging\u003cbr\u003e    script:\u003cbr\u003e     - apt-get update \u0026amp;\u0026amp; apt-get install zip -y\u003cbr\u003e     - dotnet publish -c Release -o ./publish\u003cbr\u003e     - cp appspec.yml ./publish/appspec.yml\u003cbr\u003e     - cp before-iis-install-stop.bat ./publish/before-iis-install-stop.bat\u003cbr\u003e     - cp after-iis-install-start.bat ./publish/after-iis-install-start.bat\u003cbr\u003e     - cd ./publish\u003cbr\u003e     - zip -r WebApp.zip .\u003cbr\u003e     - pipe: atlassian/aws-code-deploy:0.2.5\u003cbr\u003e      variables:\u003cbr\u003e       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION\u003cbr\u003e       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID\u003cbr\u003e       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY\u003cbr\u003e       APPLICATION_NAME: $APPLICATION_NAME\u003cbr\u003e       S3_BUCKET: $S3_BUCKET\u003cbr\u003e       COMMAND: \"upload\"\u003cbr\u003e       ZIP_FILE: \"WebApp.zip\"\u003cbr\u003e       VERSION_LABEL: \"web-app-1.0.0\"\u003cbr\u003e     - pipe: atlassian/aws-code-deploy:0.2.5\u003cbr\u003e      variables:\u003cbr\u003e       AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION\u003cbr\u003e       AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID\u003cbr\u003e       AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY\u003cbr\u003e       APPLICATION_NAME: $APPLICATION_NAME\u003cbr\u003e       DEPLOYMENT_GROUP: $DEPLOYMENT_GROUP\u003cbr\u003e       S3_BUCKET: $S3_BUCKET\u003cbr\u003e       COMMAND: \"deploy\"\u003cbr\u003e       WAIT: \"true\"\u003cbr\u003e       VERSION_LABEL: \"web-app-1.0.0\"\u003cbr\u003e       IGNORE_APPLICATION_STOP_FAILURES: \"true\"\u003cbr\u003e       FILE_EXISTS_BEHAVIOR: \"OVERWRITE\"\u003cbr\u003e       DEBUG: \"true\"\u003cbr\u003e    artifacts:\u003cbr\u003e     - dist/**\u003c/pre\u003e\n\u003ch4\u003e3. Create appspec.yml, before-iis-install-stop.bat, and after-iis-install-start.bat in the root folder of the project\u003c/h4\u003e\n\u003cp\u003eappspec.yml is to tell AWS CodeDeploy what to do in the deployment process.\u003cbr\u003ebefore-iis-install-stop.bat will stop IIS before overwriting the files to prevent IIS from still accessing the web files.\u003cbr\u003eafter-iis-install-start.bat will start IIS after copying the web files.\u003c/p\u003e\n\u003ch4\u003e4. Add Repository Variables\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003eSign in to the Bitbucket and navigate to your repository.\u003c/li\u003e\n\u003cli\u003eOn the sidebar, navigate to \u003cem\u003eRepository Settings\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eUnder the Pipelines section, click \u003cem\u003eRepository Variables\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eThese are required variables in the bitbucket-pipelines.yml:\u003cbr\u003e* AWS_ACCESS_KEY_ID\u003cbr\u003e* AWS_SECRET_ACCESS_KEY\u003cbr\u003e* AWS_DEFAULT_REGION\u003cbr\u003e* S3_BUCKET\u003cbr\u003e* APPLICATION_NAME\u003cbr\u003e* DEPLOYMENT_GROUP\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eBy following these detailed steps, you can establish a powerful and automated deployment pipeline, ensuring the smooth delivery of your applications from Bitbucket to AWS services. Say goodbye to manual deployment headaches and embrace the future of streamlined development workflows.\u003c/p\u003e\n\u003cp\u003eHappy coding and deploying!\u003c/p\u003e\n\u003cimg src=\"https://medium.com/_/stat?event=post.clientViewed\u0026amp;referrerSource=full_rss\u0026amp;postId=7fb176482f09\" width=\"1\" height=\"1\" alt=\"\"\u003e\n","enclosure":{},"categories":["deployment","cicd","streamlining","bitbucket","aws"]}},"__N_SSG":true},"page":"/blog/[guid]","query":{"guid":"7fb176482f09"},"buildId":"15dQsbTQxqQ1zDZuCA6Cy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-d24a91e6bf74100d69e6.js"></script><script src="/_next/static/chunks/main-4a62052a9e7372c56b6f.js" async=""></script><script src="/_next/static/chunks/webpack-245f049e565ebf942e09.js" async=""></script><script src="/_next/static/chunks/framework.2d0daf90a2fa7e03281a.js" async=""></script><script src="/_next/static/chunks/ede286b6.dd32408e2471bd10af40.js" async=""></script><script src="/_next/static/chunks/commons.2404f6acca6218beb883.js" async=""></script><script src="/_next/static/chunks/3959927d796506678fc851c04d7ae27fff29a3b4.ae700290d062d3eaf819.js" async=""></script><script src="/_next/static/chunks/pages/_app-37fc8646333ab19d5991.js" async=""></script><script src="/_next/static/chunks/cb1608f2.6a778bb0731dd30dbe5f.js" async=""></script><script src="/_next/static/chunks/a9a7754c.f3ac5a9a4b4ea4cabc57.js" async=""></script><script src="/_next/static/chunks/75fc9c18.c5f381fba2b0f9a9f346.js" async=""></script><script src="/_next/static/chunks/6a460d81fc8dd61038d5640eff0559b3afc3bd7a.f910f1f9daeb461adbb5.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bguid%5D-dca374df0f3820da22a8.js" async=""></script><script src="/_next/static/15dQsbTQxqQ1zDZuCA6Cy/_buildManifest.js" async=""></script><script src="/_next/static/15dQsbTQxqQ1zDZuCA6Cy/_ssgManifest.js" async=""></script></body></html>